<#bs4Body>

<div class="container-fluid">
    <input type="hidden" id="definitionId" value="${conditionDefinition.id}">
    <input type="hidden" id="selectedids" value="[]"/>
    <input type="hidden" id="" value="[]"/>
    <div class="table-wrap row justify-content-between">
        <div id="popupDiv" class="col-8">

        </div>

        <div class="table-showlist checkedShow col-3">
            <table class="table table-bordered table-hover table-condensed" id="selectedItem">
                <tr>
                    <th>${conditionDefinition.label!}</th>
                </tr>
            </table>
        </div>
    </div>
</div>
</#bs4Body>
<script>
    function addSelectedItem(key,text){
        $('.checkedShow .table').append('<tr data-id="' + key + '"><td>' + text + '<i class="fa fa-times remove-btn float-right" aria-hidden="true"></i></td></tr>');
    }
    function removeSelectedItemByKey(key){
        alert('removeSelectedItem')
    }
    var choice = parent.window.choiceTarget;
    //debugger
    var checkedids = choice.data('checkedids');
    var checkedtexts = choice.data('checkedids') ? choice.parents('.input-group').find('.form-control').val().split(',') : [];

    /* 选择项 子父页面的存储 处理  */
    $(document).ready(function () {
        let definitionId = $('#definitionId').val();
        loadAjaxTable(definitionId);
        $.each(checkedids, function(k,ele) {
            $('body').find('.checkboxWrap [data-id="' + parseInt(ele) + '"]').find(':checkbox').click();
            if (!$('.checkedShow .table [data-id="' + ele + '"]').length) {
                $('.checkedShow .table').append('<tr data-id="' + parseInt(ele) + '"><td>' + checkedtexts[k] + '<i class="fa fa-times remove-btn float-right" aria-hidden="true"></i></td></tr>');
            }
        });
    });

    /**
     * 根据条件定义，动态加载表格
     * @param definitionId
     * @param params
     */
    function loadAjaxTable(definitionId, params) {
        let data = {};
        $.extend(data, {'definitionId': definitionId});
        $.extend(data, params);
        let json =  JSON.stringify(data);
        let html = $.ajax({
            type: "POST",
            url: "${contextPath}/conditionDefinition/popupPage.action",
            data: json,
            contentType: "application/json",
            dataType: "json",
            async: false,
        }).responseText;
        $("#popupDiv").html(html);
    }


</script>
