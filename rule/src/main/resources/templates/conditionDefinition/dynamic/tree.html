<!-- 引入Vue -->
<script src="${contextPath}/resources/design/vue@2.6.11.js"></script>
<!-- 引入element -->
<link rel="stylesheet" href="${contextPath}/resources/design/index.css">
<script src="${contextPath}/resources/design/index.js"></script>
<script src="/resources/bui/js/global.js"></script>

<div id="app">
    <form id="queryForm" role="form">
        <input type="hidden" id="page" name="page" value="1">
        <input type="hidden" id="rows" name="rows" value="10">
        <input type="hidden" id="definitionId" name="definitionId" value="${conditionDefinition.id}">
        <div class="row row-cols-4">
            <%if (has(inputConditionDefinitions) && isNotEmpty(inputConditionDefinitions) && inputConditionDefinitions.~size >0 ){
            for(input in inputConditionDefinitions){
            %>
            <div class="form-group col-auto">
                <label for="">${input.label}</label>
                <input type="text" class="form-control"  name="${input.matchKey}" value="${params[input.matchKey]}">
            </div>
            <%}%>
            <div class="col align-self-center mt-3">
                <button type="button" class="btn btn-outline-primary mr-2"
                        onclick="javascript:$('#queryForm .form-control').val('');"><i
                        class="fa fa-refresh"></i> 清空
                </button>
                <button type="button" class="btn btn-outline-primary" onclick="queryData();"><i
                        class="fa fa-search"></i> 查询
                </button>
            </div>
            <%}%>

        </div>
    </form>
    <hr>
    <div class="row">
        <el-tree :data="data" ref="tree" :props="defaultProps" show-checkbox @check-change="handleCheckChange"></el-tree>
    </div>
</div>

<script>
    var displayColumnCode=JSON.parse('${displayColumn}').columnCode;
    var matchColumn='${conditionDefinition.matchColumn}';
    var nodeArray=JSON.parse('${nodes}');

    /**
     * 条件查询操作
     */
    function queryData() {
        let formData = $('#queryForm').serializeJSON();
        loadAjaxTable($("#definitionId").val(), formData);
        $('.checkedShow tr').each(function (i, ele) {
            $('.checkboxWrap tr[data-id="' + $(ele).data('id') + '"]').find(':checkbox').prop('checked', true);
        })
    }

    var app = new Vue({
        el: '#app',
        created: function (){
            this.data = toEleTree(nodeArray, {label: displayColumnCode, pid: "parent"});
        },
        data() {
            return {
                data: [],
                defaultProps: {
                    children: 'children',
                    label: 'label'
                }
            };
        },
        methods: {
            handleCheckChange(data, checked, indeterminate) {
                let checkedNodes = this.$refs.tree.getCheckedNodes();
                checkedids = checkedNodes.map(item => {
                    return item[matchColumn];
                });
                checkedtexts = checkedNodes.map(item => {
                    return item[displayColumnCode];
                });

            }
        }
    })
</script>
