<#bs4Body>
<div class="container-fluid">
    <form id="addForm" role="form" novalidate>
        <input type="hidden" name="ruleCondition" value="${conditionDefinition.ruleCondition!}">
        <input type="hidden" name="dataTargetId" value="${conditionDefinition.dataTargetId!}">
        <input type="hidden" id="id" name="id" value="${conditionDefinition.id!}">
        <div class="row row-cols-1">
            <div class="form-group col">
                <label for="label" class="">标签<i class="red">*</i></label>
                <input type="text" class="form-control" id="label" name="label" maxlength="20" value="${conditionDefinition.label!}" required placeholder="用于显示的label" />
            </div>
            <div class="form-group col">
                <label for="matchKey" class="">匹配Key<i class="red">*</i></label>
                <input type="text" class="form-control" id="matchKey" name="matchKey" maxlength="20" value="${conditionDefinition.matchKey!}" required />
            </div>
            <div class="form-group col">
                <label for="matchType" class="">条件类型<i class="red">*</i></label>
                <select id="matchType" name="matchType" class="form-control" required></select>
                <#bcomboProvider _id="matchType" _provider="matchTypeProvider" _queryParams='{required:true}' _valueField="value" _textField="text" _value="${conditionDefinition.matchType!}" />
            </div>
            <div class="form-group col">
                <label for="dataType" class="">值类型<i class="red">*</i></label>
                <select id="dataType" name="dataType" class="form-control" required></select>
                <#bcomboProvider _id="dataType" _provider="valueDataTypeProvider" _queryParams='{required:true}' _valueField="value" _textField="text" _value="${conditionDefinition.dataType!}" />
            </div>
            <div class="form-group col">
                <label for="defaultValues" class="">默认值</label>
                <input type="text" class="form-control" id="defaultValues" name="defaultValues" maxlength="255" value="${conditionDefinition.defaultValues!}"  placeholder="条件默认值,多个以英文逗号隔开" />
            </div>
        </div>
        <div class="text-right mt-2">
            <button type="button" class="btn btn-secondary px-5" id="formCancel" onclick="javascript:parent.dia.hide()">取消</button>
            <button type="button" class="btn btn-primary px-5" id="formSubmit">保存</button>
        </div>
    </form>
</div>
</#bs4Body>

<script>

    /**
     * 保存定义数据
     */
    $('#formSubmit').on('click', function () {
        if (!$('#addForm').valid()) {
            return false;
        } else {
            $.ajax({
                type: 'post',
                url: "${contextPath}/conditionDefinition/save.action",
                data: $('#addForm').serialize(),
                success: function (ret) {
                    if (ret.success) {
                        bs4pop.alert("保存成功", {type: 'success', width: 400}, function () {
                            parent.dia.hide();
                            parent.queryDataHandler();
                        });
                    } else {
                        bs4pop.alert(ret.result, {width: 400, type: 'error'});
                    }
                },
                error: function (error) {
                    bui.loading.hide();
                    bs4pop.alert(error.result, {width: 400, type: 'error'}, function () {

                    });
                }
            });
        }
    });

</script>